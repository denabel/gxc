---
output: github_document
---

<img src="man/figures/gxclogo_v1_bright.png" align="right" height="200"/>

# gxc

<table style="width:100%;">
  <tr>
    <td style="width:70%; vertical-align:top;">
      <p>
      Welcome to the project website of "GESIS meets Copernicus" (GxC).
      </p>
      <p>
For many researchers in the social sciences, Earth observation (EO) data 
represents a black box. Social science researchers face many obstacles in applying 
and using these data, resulting from 1) a lack of technical expertise, 
2) a lack of knowledge of data sources and how to access them, 
3) unfamiliarity with complex data formats, such as high-resolution, 
longitudinal raster datacubes, and 4) lack of expertise in integrating the data 
into existing social science datasets. GxC aims to close the gap by creating an automated 
interface to EO data and complementary resources for social science research. 
    </p>
    </td>
    <td style="width:30%; vertical-align:top;">
      <img src="man/figures/gxclogo_v1_bright.png" alt="GxC Hex-Sticker" style="width:200px; display:block; margin:auto;">
    </td>
  </tr>
</table>

The project's core is creating an open-source tool to link time- and 
space-sensitive social science datasets with data from Earth observation programs. 
Detailed documentation and beginner-friendly tutorials complement the tool to 
showcase the capability of our project. The social science community is the 
main target group of our tool. At the same time, Earth system science researchers 
may similarly profit from integrated social science data. This project supports 
inter- and transdisciplinary research which is often made difficult because of 
technical, disciplinary, and organizational barriers. The project emphasizes 
research data management (RDM) workflows based on FAIR and Open Data principles.
All code is written in the open-source software R and is made available on this
website.

## Example for ERA5 and polygons

### Package setup

```{r setup}
# Install and load required packages
required_packages <- c("devtools", "keyring", "rnaturalearth", "sf", "tidyverse")
new_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)
lapply(required_packages, library, character.only = TRUE)

# Load gxc package (locally for now)
devtools::load_all()
```


### Load a world map

```{r map}
# Download world map data
world <- ne_countries(scale = "medium", returnclass = "sf")
st_geometry(world)

# Subset to relevant variables
world <- world |> 
  select(admin, iso_a3, postal, geometry)

# Create fixed date-variable
world$date_raw <- "08-2014"

# Plot world map
plot(world[1])
```


### Store your API-key

```{r key}
api_key <- Sys.getenv("WF_API_KEY")

keyring::key_set_with_value(service = "wf_api_key", password = api_key)

```


### Run poly_link-function

```{r poly_link}
dataset_out <- poly_link(
  indicator = "2m_temperature",
  data = world,
  date_var = "date_raw",
  time_span = 0,
  time_lag = 0,
  baseline = FALSE,
  min_year = "1989",
  max_year = "1990",
  order = "my",
  path = "./data/raw")

```

### Explore the extended dataset

```{r dataset}
head(dataset_out)

```

```{r visualize}
ggplot(data = dataset_out) +
  geom_sf(aes(fill = focal_value)) +
  scale_fill_viridis_c() +
  theme_minimal() +
  labs(
    title = "Mean temperature (K) in August 2014",
    subtitle = "Averaged across countries",
    fill = "Temperature (K)"
  )

```
